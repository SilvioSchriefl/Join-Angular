<div class="board_content">
    <div class="header">
        <div class="headline">Board</div>
        <div class="search">
            <div class="input">
                <input type="text" placeholder="Find task" [(ngModel)]="search_text">
                <div class="input_img">
                    <img src="/assets/img/Vector 3.png" alt="">
                    <img src="/assets/img/search.png" alt="">
                </div>
            </div>
            <div class="blue_button">
                Add task
                <img src="/assets/img/add (1).png">
            </div>
        </div>
    </div>
    <div class="status_main">

        <!-------------------------------------------------------------------TODO----------------------------------------------------------------------------->

        <div class="task_status">
            <div class="status_text">
                To do
                <img src="/assets/img/plus-button-darkblue.png">
            </div>
            <div *ngIf="task_status_todo.length == 0 && !drag_start" class="empty_status">No tasks to do</div>

            <div [ngClass]="{ 'droplist_border': drag_start }" cdkDropList [cdkDropListData]="task_status_todo"
                (cdkDropListDropped)="onItemDrop($event, 'todo' )" id="todo"
                [cdkDropListConnectedTo]="['todo', 'progress', 'await','done']">

                <div class="task_main" *ngFor="let task of task_status_todo; let i = index" cdkDrag
                    (cdkDragStarted)="onDragStarted($event)" (cdkDragEnded)="onDragEnded($event)">
                    <div class="category" [style.background-color]="task.category_color">{{task.category_title}}</div>

                    <span>{{task.title}}</span>
                    <span>{{task.description}}</span>
                    <div class="subtask">
                        <div class="subtask_progress_bar">
                            <div class="subtask_progress" [style.width]="getSubtaskProgressPercent(i, 'todo')"></div>
                        </div>
                        {{getSubtaskProgress(i, 'todo')}}/{{task.subtasks.length}}
                        <span>Subtasks</span>
                    </div>
                    <div class="assigned_contacts">
                        <div *ngFor="let contact of getAssignendContacts(i, 'todo'); let k = index"
                            [class.d_none]="k > 1">
                            <div class="circle" [style.background-color]="contact.color">
                                <span>{{contact.initials}}</span>
                            </div>
                        </div>
                        <div *ngIf="getNumberOfContacts(i, 'todo') > 0" class="circle"
                            style="background-color: #2A3647;">
                            <span> + {{getNumberOfContacts(i , 'todo')}}</span>
                        </div>
                        <img *ngIf="task.prio =='medium'" src="/assets/img/prioMedium.png">
                        <img *ngIf="task.prio =='urgent'" src="/assets/img/prioUrgent.png">
                        <img *ngIf="task.prio =='low'" src="/assets/img/prioLow.png">
                    </div>
                </div>
            </div>
        </div>

        <!-------------------------------------------------------------------PROGRESS----------------------------------------------------------------------------->

        <div class="task_status">
            <div class="status_text">
                In progress
                <img src="/assets/img/plus-button-darkblue.png">
            </div>
            <div *ngIf="task_status_in_progress.length == 0 && !drag_start" class="empty_status">No tasks in progress
            </div>
            <div [ngClass]="{ 'droplist_border': drag_start }" cdkDropList [cdkDropListData]="task_status_in_progress"
                (cdkDropListDropped)="onItemDrop($event, 'progress')" id="progress"
                [cdkDropListConnectedTo]="['todo', 'progress', 'await','done']">
                <div class="task_main" *ngFor="let task of task_status_in_progress; let i = index" cdkDrag
                    (cdkDragStarted)="onDragStarted($event)" (cdkDragEnded)="onDragEnded($event)">
                    <div class="category" [style.background-color]="task.category_color">{{task.category_title}}</div>
                    <span>{{task.title}}</span>
                    <span>{{task.description}}</span>
                    <div class="subtask">
                        <div class="subtask_progress_bar">
                            <div class="subtask_progress" [style.width]="getSubtaskProgressPercent(i, 'progress')">
                            </div>
                        </div>
                        {{getSubtaskProgress(i, 'progress')}}/{{task.subtasks.length}}
                        <span>Subtasks</span>
                    </div>
                    <div class="assigned_contacts">
                        <div *ngFor="let contact of getAssignendContacts(i, 'progress'); let k = index"
                            [class.d_none]="k > 1">
                            <div class="circle" [style.background-color]="contact.color">
                                <span>{{contact.initials}}</span>
                            </div>
                        </div>
                        <div *ngIf="getNumberOfContacts(i, 'progress') > 0" class="circle"
                            style="background-color: #2A3647;">
                            <span> + {{getNumberOfContacts(i , 'progress')}}</span>
                        </div>
                        <img *ngIf="task.prio =='medium'" src="/assets/img/prioMedium.png">
                        <img *ngIf="task.prio =='urgent'" src="/assets/img/prioUrgent.png">
                        <img *ngIf="task.prio =='low'" src="/assets/img/prioLow.png">
                    </div>
                </div>
            </div>
        </div>

        <!-------------------------------------------------------------------AWAIT----------------------------------------------------------------------------->

        <div class="task_status">
            <div class="status_text">
                Await feedback
                <img src="/assets/img/plus-button-darkblue.png">
            </div>
            <div *ngIf="task_status_await.length == 0 && !drag_start" class="empty_status">No tasks await feedback</div>
            <div [ngClass]="{ 'droplist_border': drag_start }" cdkDropList [cdkDropListData]="task_status_await"
                (cdkDropListDropped)="onItemDrop($event, 'await')" id="await"
                [cdkDropListConnectedTo]="['todo', 'progress', 'await','done']">
                <div class="task_main" *ngFor="let task of task_status_await; let i = index" cdkDrag
                    (cdkDragStarted)="onDragStarted($event)" (cdkDragEnded)="onDragEnded($event)">
                    <div class="category" [style.background-color]="task.category_color">{{task.category_title}}</div>
                    <span>{{task.title}}</span>
                    <span>{{task.description}}</span>
                    <div class="subtask">
                        <div class="subtask_progress_bar">
                            <div class="subtask_progress" [style.width]="getSubtaskProgressPercent(i, 'await')"></div>
                        </div>
                        {{getSubtaskProgress(i, 'await')}}/{{task.subtasks.length}}
                        <span>Subtasks</span>
                    </div>
                    <div class="assigned_contacts">
                        <div *ngFor="let contact of getAssignendContacts(i, 'await'); let k = index"
                            [class.d_none]="k > 1">
                            <div class="circle" [style.background-color]="contact.color">
                                <span>{{contact.initials}}</span>
                            </div>
                        </div>
                        <div *ngIf="getNumberOfContacts(i, 'await') > 0" class="circle"
                            style="background-color: #2A3647;">
                            <span> + {{getNumberOfContacts(i , 'await')}}</span>
                        </div>
                        <img *ngIf="task.prio =='medium'" src="/assets/img/prioMedium.png">
                        <img *ngIf="task.prio =='urgent'" src="/assets/img/prioUrgent.png">
                        <img *ngIf="task.prio =='low'" src="/assets/img/prioLow.png">
                    </div>
                </div>
            </div>
        </div>

        <!-------------------------------------------------------------------DONE----------------------------------------------------------------------------->

        <div class="task_status">
            <div class="status_text">
                Done
                <img src="/assets/img/plus-button-darkblue.png">
            </div>
            <div *ngIf="task_status_done.length == 0 && !drag_start" class="empty_status">No tasks done</div>
            <div [ngClass]="{ 'droplist_border': drag_start }" cdkDropList [cdkDropListData]="task_status_done"
                (cdkDropListDropped)="onItemDrop($event, 'done')" id="done"
                [cdkDropListConnectedTo]="['todo', 'progress', 'await','done']">
                <div (click)="openTaskDetail(i, 'done')" class="task_main"
                    *ngFor="let task of task_status_done; let i = index" cdkDrag
                    (cdkDragStarted)="onDragStarted($event)" (cdkDragEnded)="onDragEnded($event)">
                    <div class="category" [style.background-color]="task.category_color">{{task.category_title}}</div>
                    <span>{{task.title}}</span>
                    <span>{{task.description}}</span>
                    <div class="subtask">
                        <div class="subtask_progress_bar">
                            <div class="subtask_progress" [style.width]="getSubtaskProgressPercent(i, 'done')"></div>
                        </div>
                        {{getSubtaskProgress(i, 'done')}}/{{task.subtasks.length}}
                        <span>Subtasks</span>
                    </div>
                    <div class="assigned_contacts">
                        <div *ngFor="let contact of getAssignendContacts(i, 'done'); let k = index"
                            [class.d_none]="k > 1">
                            <div class="circle" [style.background-color]="contact.color">
                                <span>{{contact.initials}}</span>
                            </div>
                        </div>
                        <div *ngIf="getNumberOfContacts(i, 'done') > 0" class="circle"
                            style="background-color: #2A3647;">
                            <span> + {{getNumberOfContacts(i , 'done')}}</span>
                        </div>
                        <img *ngIf="task.prio =='medium'" src="/assets/img/prioMedium.png">
                        <img *ngIf="task.prio =='urgent'" src="/assets/img/prioUrgent.png">
                        <img *ngIf="task.prio =='low'" src="/assets/img/prioLow.png">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="task_detail_main" *ngIf="globalService.open_task_details">
    <div class="close" (click)="closeTaskDetails()">
        <img src="/assets/img/close.png">
    </div>
    <div class="category" [style.background-color]="detail_task[0].category_color">{{detail_task[0].category_title}}
    </div>
    <span class="title">{{detail_task[0].title}}</span>
    <span>{{detail_task[0].description}}</span>
    <div class="task_detail">
        Due date :
        <span>{{detail_task[0].due_date}}</span>
    </div>
    <div class="task_detail">
        Priority:
        <div *ngIf="detail_task[0].prio =='medium'">
            <span>Medium</span>
            <img src="/assets/img/prioMedium.png">
        </div>
        <div *ngIf="detail_task[0].prio =='urgent'">
            <span>Urgent</span>
            <img src="/assets/img/prioUrgent.png">
        </div>
        <div *ngIf="detail_task[0].prio =='low'">
            <span>Low</span>
            <img src="/assets/img/prioLow.png">
        </div>
    </div>
    Assigned to:
    <div class="detail_contacts_main">
        <div class="detail_contacts_scroll">
            <div class="contacts_list" *ngFor="let contact of getAssignendContacts(0, 'detail')"
                (click)="openContact()">
                <div class="circle" [style.background-color]="contact.color">{{contact.initials}}</div>
                <span>{{contact.user_name}}</span>
            </div>
        </div>
    </div>
    Subtasks
    <div class="subtasks_main">
        <div class="subtasks_scroll">
            <div class="subtask_list" *ngFor="let subtask of detail_task[0].subtasks; let i = index">
                <input type="checkbox" [checked]="subtask.done" (change)="updateSubtaskStatus($event, i)">
                <span>{{subtask.title}}</span>
            </div>
        </div>
    </div>
    <div class="edit_buttons_main">
        <div class="edit_buttons">
            <img src="/assets/img/delete.png" alt="">
            Delete
        </div>
        <img src="/assets/img/Vector 3.png" alt="">
        <div class="edit_buttons" (click)="openEditTask()">
            <img src="/assets/img/edit.png" alt="">
            Edit
        </div>
    </div>
</div>

<!---------------------------------------------------------------EDIT TASK------------------------------------------------------------------->

<div *ngIf="open_edit_task" class="task_edit_main">
    <div class="task_detail_scroll">
        <div class="close" (click)="backToTaskDetails()">
            <img src="/assets/img/arrow-black.png">
        </div>
        <div class="details_input">
            Title :
            <input type="text" [(ngModel)]="detail_task[0].title">
        </div>
        <div class="details_input">
            Description :
            <textarea [(ngModel)]="detail_task[0].description"></textarea>
        </div>
        <div class="details_input">
            Due Date
            <input type="date" [(ngModel)]="detail_task[0].due_date">
        </div>
        <div class="details_input">
            Priority :
            <div class="prio_main">
                <div class="prio" (click)="setPrio('urgent')" [class.urgent]="detail_task[0].prio == 'urgent'">
                    <span>Urgent</span>
                    <img src="/assets/img/prioUrgent.png">
                </div>
                <div class="prio" (click)="setPrio('medium')" [class.medium]="detail_task[0].prio == 'medium'">
                    <span>Medium</span>
                    <img src="/assets/img/prioMedium.png">
                </div>
                <div class="prio" (click)="setPrio('low')" [class.low]="detail_task[0].prio == 'low'">
                    <span>Low</span>
                    <img src="/assets/img/prioLow.png">
                </div>
            </div>
        </div>

        <!------------------------------------------------------------------CONTACTS---------------------------------------------------------------->
        <div class="details_input">
            <span>Assigned to</span>
            <div *ngIf="!open_dropdown" (click)="globalService.stopPropagation($event)" class="dropdown_menu"
                (click)="toggleDropDownMenu()">
                <span>Select contacts to assign</span>
                <div class="dropdown">
                    <img src="/assets/img/arrow_drop_down.png" [style.transform]="rotationValue">
                </div>
            </div>

            <div *ngIf="open_dropdown" class="input_title_hide" (click)="globalService.stopPropagation($event)"
                [class.add_shadow]="open_dropdown">
                <input type="text" style="z-index: 2" placeholder="Search contact" [(ngModel)]="search_value"
                    (ngModelChange)="handleValueChangeOnSearch($event)">
                <div class="dropdown_search" (click)="toggleDropDownMenu()">
                    <img src="/assets/img/arrow_drop_down.png" [style.transform]="rotationValue">
                </div>
                <div class="contact_main" (click)="globalService.stopPropagation($event)"
                    [class.show_element]="open_dropdown">

                    <div class="contacts_scroll_div">
                        <span class="no_contact" *ngIf="selected_users_list.length == 0">No contact found</span>
                        <div class="contact_div" [class.selected]="contact.selected"
                            *ngFor="let contact of selected_users_list; let i = index"
                            (click)="selectContact(contact.email, i)">
                            <div class="circle" [style.background-color]="contact.color">{{contact.initials}}</div>
                            {{contact.user_name}} <span *ngIf="contact.email == userService.user.email">(you)</span>
                            <input type="checkbox" class="checkbox" [checked]="contact.selected">
                        </div>
                    </div>
                    <footer>
                        <div class="blue_button" (click)="globalService.stopPropagation($event)">
                            <span>Add new contact</span>
                            <img src="/assets/img/person_add.png">
                        </div>
                    </footer>
                </div>
            </div>
        </div>
        <div class="selected_contacts">
            <div *ngFor="let contact of selected_users_list; let i = index">
                <div class="circle" [style.background-color]="contact.color" *ngIf="contact.selected">
                    {{contact.initials}}</div>
            </div>
        </div>

<!-------------------------------------------------------EDIT SUBTASKS----------------------------------------------------------------------->

        <div class="details_input">
            <span>Subtasks</span>
            <input type="text" placeholder="Add subtask" [(ngModel)]="subtask_title">
            <div class="add" (click)="addSubtask()">
                <img src="/assets/img/add.png">
            </div>

            <div class="subtask_main">
                <div class="subtask_scroll">
                    <div *ngFor="let subtask of detail_task[0].subtasks; let i = index">
                        <div class="subtask_edit" *ngIf="!subtask.selected">
                            {{subtask.title}}
                            <div class="subtask_img">
                                <div class="delete" (click)="deleteSubtask(i)">
                                    <img src="/assets/img/delete.png">
                                </div>
                                <img src="/assets/img/Vector 19.png">
                                <div class="delete" (click)="openEditSubtask(i)">
                                    <img src="/assets/img/edit.png">
                                </div>
                            </div>
                        </div>
                        <div *ngIf="subtask.selected" class="input_edit">
                            <input type="text" [(ngModel)]="edited_subtask_title">
                            <div class="subtask_img_input">
                                <div class="delete" (click)="deleteSubtask(i)">
                                    <img src="/assets/img/delete.png">
                                </div>
                                <img src="/assets/img/Vector 19.png">
                                <div class="delete" (click)="saveEditSubtask(i)">
                                    <img src="/assets/img/Vector 17.png">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="blue_button">Save</div>
            </div>
            
        </div>
        
    </div>
    
</div>